chrome.runtime.onMessage.addListener((t,o,i)=>{let e=o.tab?o.tab.id:null;if(!e)return;switch(console.log("onMessage",t.type),t.type){case"PLAYING":let c=new URL(o.tab.url).hostname;if(c)chrome.storage.local.get(["global",c],(a)=>{let s=a.global||{},n=a[c]||{};if(!n.stop&&(n.enable||!s.disable))chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},files:["src/ppp-inject.js"]})});i(!0);break;case"UPDATE_ICON":if(t.stop)chrome.action.setIcon({path:"/icons/icon-48.png",tabId:e}),chrome.action.setBadgeText({tabId:e});else{if(t.speed)chrome.action.setBadgeText({text:t.speed.toString(),tabId:e});else chrome.action.setBadgeText({tabId:e});if(t.leq)chrome.action.setIcon({path:"/icons/icon-eq.png",tabId:e});else chrome.action.setIcon({path:"/icons/icon-on.png",tabId:e})}break}});
